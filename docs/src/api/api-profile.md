# ユーザープロフィール管理API定義書

### 📜 概要

-   **機能:** ログインしたユーザーのプロフィール情報（名前、パスワード）を修正し、クレジットをチャージし、関連情報を`localStorage`に保存します。
-   **呼び出し時点:** マイページ(`/profile`)でユーザーがプロフィール情報修正またはクレジットチャージ機能を使用するときに呼び出されます。
-   **主要ロジックファイル:** `src/pages/Profile.jsx` (`handleNameUpdate`、`handlePasswordUpdate`、`handleCharge` 関数)

---

### 📊 API 主要情報

*   **API 名称:** ユーザープロフィール管理 (クライアント内部処理)
*   **対象ストレージ:** `localStorage`
*   **処理概要:** `localStorage`に保存されたユーザー情報（`users`、`currentUser`）を直接更新するか、`CreditContext`を通じてクレジット情報を管理します。

---

### ➡️ リクエスト (Request)

#### 1. 名前更新 (クライアント内部関数呼び出し: `handleNameUpdate`)

| フィールド名 | タイプ     | 説明           | 必須かどうか | 例値         |
| --------- | -------- | -------------- | --------- | --------------- |
| `newName` | `string` | 変更するユーザー名 | 必須      | `新しい名前`      |

#### 2. パスワード更新 (クライアント内部関数呼び出し: `handlePasswordUpdate`)

| フィールド名   | タイプ     | 説明           | 必須かどうか | 例値         |
| ----------- | -------- | -------------- | --------- | --------------- |
| `newPassword`| `string` | 変更するパスワード | 必須      | `newPassword123!` |

#### 3. クレジットチャージ (クライアント内部関数呼び出し: `handleCharge`)

| フィールド名   | タイプ     | 説明           | 必須かどうか | 例値         |
| ----------- | -------- | -------------- | --------- | --------------- |
| `chargeAmount`| `number` | チャージするクレジット金額 | 必須      | `10000`         |

---

### ⬅️ レスポンス (Response)

#### ✅ 成功レスポンス (クライアント内部処理)

*   **名前更新成功:**
    *   **処理結果:** `localStorage`の`users`および`currentUser`にユーザー名を更新。
    *   **ユーザーフィードバック:** 「名前が変更されました。」通知表示。
*   **パスワード更新成功:**
    *   **処理結果:** `localStorage`の`users`および`currentUser`にユーザーパスワードを更新。`AuthContext`状態を同期。
    *   **ユーザーフィードバック:** 「パスワードが変更されました。」通知表示。
*   **クレジットチャージ成功:**
    *   **処理結果:** `CreditContext`を通じてクレジット残高を更新。
    *   **ユーザーフィードバック:** `${amount.toLocaleString()} 円がチャージされました。` 通知表示。

#### ❌ エラーレスポンス (クライアント内部処理)

| エラータイプ         | ユーザーフィードバックメッセージ             | 説明                                     |
| ----------------- | -------------------------------- | ---------------------------------------- |
| `名前入力不足`  | `名前を入力してください。`       | 名前フィールドが空です。               |
| `パスワード入力不足`| `新しいパスワードを入力してください。` | 新しいパスワードフィールドが空です。        |
| `パスワード有効性失敗`| `パスワードは8〜20文字で、英字、数字、特殊文字をすべて含む必要があります。` | パスワードが有効性ルールを満たしていません。 |
| `クレジット金額エラー` | `チャージ金額を正しく入力してください。` | チャージ金額が無効です（数字ではないか0以下）。 |